openapi: 3.0.0
info:
  title: Botsi AI Pricing Model API
  description: |
    API for dynamic paywall prediction, user profile management, and purchase validation.
    All requests require a secret key for authentication.
  version: 1.0.0

servers:
  - url: https://app.botsi.com/api/v1/web-api
    description: Production Server

components:
  securitySchemes:
    SecretKey:
      type: apiKey
      in: header
      name: Authorization
      description: |
        The secret key found on your App configuration page on the Botsi site.
        Format: {{secret_key}}

  schemas:
    AppleStoreValidationRequest:
      type: object
      required:
        - transactionId
        - originalTransactionId
        - placementId
        - productId
        - paywallId
        - isExperiment
        - aiPricingModelId
        - environment
      properties:
        transactionId:
          type: string
          description: Apple transaction identifier.
          example: "2200000871590381"
        originalTransactionId:
          type: string
          description: Apple original transaction identifier.
          example: "2200000261699248"
        profileId:
          type: string
          description: Provide either profileId or customerUserId.
          example: "FFF3C120-0CA8-480F-9B19-3955A5428E39"
        customerUserId:
          type: string
          description: External customer ID (alternative to profileId).
        placementId:
          type: string
          description: Placement ID configured in Botsi.
          example: "somePlacementId"
        productId:
          type: string
          description: App Store product identifier configured in Botsi.
          example: "accessercise_6_months"
        paywallId:
          type: integer
          description: Paywall ID from Get Paywall response `data.id`.
          example: 1
        source:
          type: string
          description: Purchase source context.
          enum: [restore, purchasing, observing]
          example: purchasing
        isSubscription:
          type: boolean
          description: Whether this purchase is a subscription.
          example: true
        isExperiment:
          type: boolean
          description: Should match Get Paywall response `data.isExperiment`.
          example: true
        aiPricingModelId:
          type: integer
          description: Should match Get Paywall response `data.aiPricingModelId`.
          example: 123
        environment:
          $ref: '#/components/schemas/EnvironmentType'
      oneOf:
        - required: [profileId]
        - required: [customerUserId]
      example:
        placementId: "somePlacementId"
        paywallId: 1
        source: "purchasing"
        productId: "accessercise_6_months"
        isSubscription: true
        originalTransactionId: "2200000261699248"
        environment: "sandbox"
        transactionId: "2200000871590381"
        profileId: "FFF3C120-0CA8-480F-9B19-3955A5428E39"
        isExperiment: true
        aiPricingModelId: 123
    
    PlatformType:
      type: string
      enum: [android, ios, ipados, tvos, macos, watchos, visionos, stripe]
      description: The platform identifier for the device.
      example: ios
    
    StoreType:
      type: string
      enum: [app_store, play_store, stripe]
      description: The sales platform or payment processor.
      example: play_store

    EnvironmentType:
      type: string
      enum: [production, sandbox]
      description: Set to production when the app is live and to sandbox for testing purposes only.
      example: production

    PricingPhase:
      type: object
      required: [priceAmountMicros, currencyCode, billingPeriod, recurrenceMode]
      properties:
        priceAmountMicros:
          type: integer
          description: |
            The price for the payment cycle in micro-units, where 1,000,000 micro-units equal one unit of the currency.
            A trial period can be identified when this is 0.
          example: 9990000
        currencyCode: 
          type: string
          description: ISO 4217 currency code for price.
          example: USD
        billingPeriod: 
          type: string
          description: Billing period for which the given price applies, specified in ISO 8601 format.
          example: P1M
        recurrenceMode: 
          type: integer
          description: Recurrence mode of the pricing phase.
          example: 1
        billingCycleCount: 
          type: integer
          description: Number of cycles for which the billing period is applied.
          example: 0 

    ProfileData:
      type: object
      properties:
        profileId: 
          type: string
          description: The unique identifier generated by Botsi for this user profile.
          example: "a373df7c-dbff-42a4-b22f-b6d151971806"
        createdDate:
          type: string
          description: The date and time the profile was created.
          example: "2025-09-18T08:18:58.9737"
        state:
          type: string
          description: The subscription status of the user.
          example: "never-subscribed"
        customerUserId: 
          type: string
          nullable: true
          description: The unique ID of the customer in your system. It isn't required, but it's strongly recommended.
          example: "test.mail@mail.test"
        country: 
          type: string
          description: The country where the user is located.
          example: "US"
        device: 
          type: string
          description: The user's device model.
          example: "Iphone 15"
        os: 
          type: string
          description: The operating system running on the device.
          example: "ios 15.0.2"
        platform: 
          type: string
          description: The platform identifier.
          example: "ios"
        totalRevenueUsd: 
          type: number
          description: Total revenue generated by the user in USD.
          example: "0"
        botsiSdkVersion:
          type: string
          example: "1.0"
        accessLevels: 
          type: object
          description: Map of active access levels or entitlements.
        subscriptions: 
          type: object
          description: Detailed status of active and expired subscriptions.

    AttributeObject:
      type: object
      required: [key, value]
      properties:
        key:
          type: string
          description: The attribute key.
          example: "user_level"
        value:
          type: string
          description: The attribute value.
          example: "premium"

    AttributeResponse:
      type: object
      properties:
        id:
          type: string
          description: The unique ID assigned to the custom attribute.
        key:
          type: string
        value:
          type: string

    CustomAttributeRequest:
      type: object
      required: [custom]
      properties:
        profileId:
          type: string
          description: The unique Botsi profile ID.
          example: "0072102a-c00c-4ea5-9271-1b6e975f2d63"
        customerUserId:
          type: string
          description: The customer user ID from your system.
          example: "user-123"
        custom:
          $ref: '#/components/schemas/AttributeObject'

    UpdateAttributeRequest:
      allOf:
        - $ref: '#/components/schemas/CustomAttributeRequest'
        - type: object
          required: [attrId]
          properties:
            attrId:
              type: string
              description: Required ID of the custom attribute to update.

    BulkAttributeRequest:
      type: object
      required: [custom]
      properties:
        profileId:
          type: string
        customerUserId:
          type: string
        custom:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/AttributeObject'

    PaywallData:
      type: object
      properties:
        aiPricingModelId:
          type: integer
          description: AI Pricing model ID on Botsi.
          example: 32
        id:
          type: integer
          description: Internal Paywall ID on Botsi.
          example: 1
        externalId:
          type: string
          description: External Paywall ID, the same as used on the app and AI Pricing model.
          example: "110007"
        name:
          type: string
          description: The name assigned to the paywall.
          example: "Free"
        remoteConfigs:
          type: object
          nullable: true
          description: Optional remote configuration payload.
          example: null
        revision:
          type: integer
          description: Paywall revision number.
          example: 1
        sourceProducts:
          type: array
          description: Products included in the returned paywall.
          items:
            type: object
            properties:
              botsiProductId:
                type: integer
                example: 1
              isConsumable:
                type: boolean
                example: false
              sourcePoductId:
                type: string
                description: Source product identifier (as returned by the API).
                example: "free.app.store.p.id"
              appStoreOfferType:
                type: string
                example: "promotional"
              promotionalOfferId:
                type: string
                example: "app_store_offer_free"
              winBackOfferId:
                type: string
                nullable: true
                example: null
        placementId:
          type: string
          description: Placement ID that produced this paywall.
          example: "ai-placement-id"
        isExperiment:
          type: boolean
          description: Indicates paywall returned by AI Pricing model.
          example: true


    ProfileEvent:
      type: object
      required: [eventType, paywallId, placementId, isExperiment, aiPricingModelId]
      properties:
        eventType: 
          type: string
          enum: [paywall_shown]
          description: The type of event.
          example: paywall_shown
        paywallId: 
          type: integer
          description: Paywall ID. Taken from Get Paywall API response field `data.id`.
          example: 1
        placementId: 
          type: string
          description: The Placement ID corresponding to the placement configured in Botsi.
          example: "ai-placement-id"
        isExperiment: 
          type: boolean
          description: Should be the same as returned by Get Paywall API.
          example: true
        aiPricingModelId: 
          type: integer
          description: Should match Get Paywall API response field `data.aiPricingModelId`
          example: 32
        profileId: 
          type: string
          description: The profileId returned from the profile creation call (botsi's profile ID). Provide either profileId or customerUserId.
          example: "123-abc"
        customerUserId: 
          type: string
          description: The unique ID of the customer in your system. It isn't required, but it's strongly recommended.
        attributionSource:
          type: string
          description: Attribution source (if relevant).
          example: Facebook Ads
      oneOf:
        - required: [profileId]
        - required: [customerUserId]

    CreateProfileRequest:
      type: object
      required: [country, device, os, platform, appVersion]
      properties:
        country: 
          type: string
          description: The country where the user is located (e.g., "US").
          example: "US"
        device: 
          type: string
          description: The user's device model.
          example: "Iphone 15"
        os: 
          type: string
          description: The operating system name.
          example: "ios"
        osVersion:
          type: string
          description: The version of the operating system.
          example: "15.0.2"
        platform: 
          $ref: '#/components/schemas/PlatformType'
        appVersion: 
          type: string
          description: The version of the installed application.
          example: "2.3.4"
        appBuild:
          type: string
          description: The specific build number of the application.
          example: "1.2.3"
        customerUserId: 
          type: string
          description: |
            The unique ID of the customer in your system. If provided for a new profile, 
            Botsi creates a profile with a random profileId linked to this ID.
          example: "user_12345"
        advertisingId: 
          type: string
          description: The device advertising identifier.
          example: "123-abc-789"
        email: 
          type: string
          description: The user's email address.
          example: "test.mail@mail.test"
        phone:
          type: string
          description: The user's phone number.
          example: "+12344556789"
        gender:
          type: string
          description: The user's gender.
          example: "male"
        locale:
          type: string
          description: The user's language/locale setting.
          example: "en"
        ip:
          type: string
          description: The user's IP address.
          example: "123.123.123.123"
      example:
        country: "US"
        device: "Iphone 15"
        os: "ios"
        osVersion: "15.0.2"
        platform: "ios"
        appVersion: "2.3.4"
        appBuild: "1.2.3"
        customerUserId: "test.mail@mail.test"
        email: "test.mail@mail.test"
        locale: "en"

    GetPaywallRequest:
      type: object
      required: [deviceTypeModel, osVersion, languageLocale, placementId, store]
      properties:
        deviceTypeModel:
          type: string
          description: The user's device model.
          example: "iPhone 13"
        osVersion:
          type: string
          description: The device operating system version.
          example: "iOS 16.0"
        languageLocale:
          type: string
          description: The user's language and locale.
          example: "en-US"
        placementId:
          type: string
          description: The Placement ID corresponding to the placement configured in Botsi.
          example: "ai-placement-id"
        attributionSource:
          type: string
          description: Indicates where the user action originated.
          example: "Facebook Ads"
        profileId:
          type: string
          description: Required to associate events with the corresponding profile.
          example: "123-abc"
        customerUserId:
          type: string
          description: The unique ID of the customer in your system. It isn't required, but it's strongly recommended.
        store:
          $ref: '#/components/schemas/StoreType'
      oneOf:
        - required: [profileId]
        - required: [customerUserId]
      example:
        deviceTypeModel: "iPhone 13"
        osVersion: "iOS 16.0"
        languageLocale: "en-US"
        placementId: "ai-placement-id"
        attributionSource: "Facebook Ads"
        profileId: "123-abc"
        store: "app_store"


    PlayStoreValidationRequest:
      type: object
      required: [token, placementId, productId, environment, subscriptionOfferDetails]
      properties:
        token: 
          type: string
          description: Token that uniquely identifies a purchase for a given item and user pair.
          example: "algojlnkodhhjceoicbpjngh.A0-J1owvC6A8J2u0kEpN5aNvpsFR8DXeFM0C6qK5_x"
        placementId: 
          type: string
          description: The same as Placement ID on the placement configured on the Botsi.
          example: "fresh_placement"
        productId: 
          type: string
          description: The same as Play Store Product ID on the product configured on the Botsi.
          example: "monthly"
        environment: 
          $ref: '#/components/schemas/EnvironmentType'
        paywallId: 
          type: integer
          description: Paywall ID needed for correct analytics for the AI Pricing Model.
          example: 569
        profileId: 
          type: string
          description: Required to identify the user on Botsi.
          example: "55bbd5f3-6de8-4d3b-8a55-006e6af6e3dd"
        customerUserId: 
          type: string
          description: The unique ID of the customer in your system. It isn't required, but it's strongly recommended.
        isExperiment:
          type: boolean
          description: |
            Recommended. If available, set to the value returned by Get Paywall (`data.isExperiment`)
            to improve analytics attribution.
          example: true
        aiPricingModelId:
          type: integer
          description: |
            Recommended. If available, set to the value returned by Get Paywall (`data.aiPricingModelId`)
            to improve analytics attribution.
          example: 32
        abTestId:
          type: integer
          description: Optional A/B test identifier (if used by your integration).
          example: 0
        isSubscription:
          type: boolean
          description: Whether this purchase is a subscription.
          example: true
        subscriptionOfferDetails:
          type: object
          required: [basePlanId, pricingPhases]
          description: Object from ProductDetails used to associate which subscription was purchased.
          properties:
            basePlanId:
              type: string
              example: "1month-sub"
            offerId:
              type: string
              description: Optional offer ID (only if the product has offers configured).
            pricingPhases:
              type: array
              items:
                $ref: '#/components/schemas/PricingPhase'
      oneOf:
        - required: [profileId]
        - required: [customerUserId]
      example:
        abTestId: 0
        isSubscription: true
        paywallId: 569
        placementId: "fresh_placement"
        productId: "monthly"
        environment: "production"
        profileId: "55bbd5f3-6de8-4d3b-8a55-006e6af6e3dd"
        subscriptionOfferDetails:
          basePlanId: "1month-sub"
          pricingPhases:
            - billingCycleCount: 0
              billingPeriod: "P1M"
              currencyCode: "UAH"
              priceAmountMicros: 359990000
              recurrenceMode: 1
        token: "algojlnkodhhjceoicbpjngh.A0-J1owvC6A8J2u0kEpN5aNvpsFR8DXeFM0C6qK5_x"

security:
  - SecretKey: []

paths:
  /profiles:
    post:
      summary: Create a Profile
      description: |
        Establish a user profile within Botsi. This should be triggered upon the first app launch. 
        The returned **profileId** is required for all subsequent API interactions.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProfileRequest'
      responses:
        '200':
          description: Profile created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: 
                    type: boolean
                  data: 
                    $ref: '#/components/schemas/ProfileData'
                example:
                  ok: true
                  data:
                    profileId: "a373df7c-dbff-42a4-b22f-b6d151971806"
                    createdDate: "2025-09-18T08:18:58.9737"
                    state: "never-subscribed"
                    customerUserId: "test.mail@mail.test"
                    country: "US"
                    device: "Iphone 15"
                    os: "ios 15.0.2"
                    platform: "ios"
                    appVersion: "2.3.4"
                    botsiSdkVersion: "1.0"
                    totalRevenueUsd: 0

  /profiles/custom-attributes:
    post:
      summary: Add Single Custom Attribute
      description: Creates a single custom attribute for a profile.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomAttributeRequest'
      responses:
        '200':
          description: Attribute created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttributeResponse'
    put:
      summary: Update Custom Attribute
      description: Updates an existing custom attribute for a profile.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAttributeRequest'
      responses:
        '200':
          description: Attribute updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttributeResponse'

  /profiles/custom-attributes-all:
    post:
      summary: Add Multiple Custom Attributes
      description: Creates multiple custom attributes for a single profile in parallel for optimal performance.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkAttributeRequest'
      responses:
        '200':
          description: Multiple attributes created.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AttributeResponse'

  /paywalls:
    post:
      summary: Get Paywall
      description: Fetches the AI-predicted paywall configuration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPaywallRequest'
      responses:
        '200':
          description: Paywall retrieved.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/PaywallData'
              example:
                ok: true
                data:
                  aiPricingModelId: 32
                  id: 1
                  externalId: "110007"
                  name: "Free"
                  remoteConfigs: null
                  revision: 1
                  sourceProducts:
                    - botsiProductId: 1
                      isConsumable: false
                      sourcePoductId: "free.app.store.p.id"
                      appStoreOfferType: "promotional"
                      promotionalOfferId: "app_store_offer_free"
                      winBackOfferId: null
                  placementId: "ai-placement-id"
                  isExperiment: true

  /events:
    post:
      summary: Send Profile Event
      description: Tracks paywall impressions within the platform.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              minItems: 1
              items: 
                $ref: '#/components/schemas/ProfileEvent'
            example:
              - eventType: paywall_shown
                paywallId: 1
                placementId: ai-placement-id
                isExperiment: true
                aiPricingModelId: 32
                profileId: 123-abc
                attributionSource: Facebook Ads
      responses:
        '200':
          description: Event tracked.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: 
                    type: boolean
              example:
                ok: true

  /purchases/apple-store/validate:
    post:
      summary: Validate Apple Store Purchase
      description: This call should be triggered from the app after the purchase event.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppleStoreValidationRequest'
      responses:
        '200':
          description: Validated.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/ProfileData'
              example:
                ok: true
                data:
                  profileId: "string"
                  createdDate: "string"
                  linkedProfileIds: "string"
                  state: "string"
                  customerUserId: "string"
                  migrationProfileId: "string"
                  country: "string"
                  device: "string"
                  os: "string"
                  platform: "string"
                  advertisingId: "string"
                  appBuild: "string"
                  appVersion: "string"
                  botsiSdkVersion: "string"
                  custom: []
                  email: "string"
                  phone: "string"
                  gender: "string"
                  idfa: "string"

  /purchases/play-store/validate:
    post:
      summary: Validate Google Play Store Purchase
      description: |
        This call should be triggered from the app after the purchase event.

        Recommendation:
        If you previously called Get Paywall, include `isExperiment` and
        `aiPricingModelId` from that response to improve analytics attribution.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlayStoreValidationRequest'
      responses:
        '200':
          description: Validated.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: 
                    type: boolean
                  data: 
                    $ref: '#/components/schemas/ProfileData'
              example:
                ok: true
                data:
                  profileId: "string"
                  createdDate: "string"
                  state: "string"
                  country: "string"
                  device: "string"
                  os: "string"
                  platform: "string"